---
# Debian/Ubuntu specific setup

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600
  become: true

- name: Install base Debian packages
  ansible.builtin.apt:
    name:
      - curl
      - jq
      - pavucontrol
      - traceroute
      - htop
      - fzf
      - python3-pip
      - nodejs
      - npm
      - ripgrep
      - bat
      - btop
      - colordiff
      - fd-find
      - iotop
      - flatpak
      - vlc
    state: present
  become: true

- name: Install rust via rustup
  ansible.builtin.shell: |
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  args:
    creates: "{{ ansible_env.HOME }}/.cargo/bin/cargo"
  become: false

- name: Install zoxide via cargo
  ansible.builtin.command: "{{ ansible_env.HOME }}/.cargo/bin/cargo install zoxide"
  args:
    creates: "{{ ansible_env.HOME }}/.cargo/bin/zoxide"
  become: false

- name: Install eza via cargo
  ansible.builtin.command: "{{ ansible_env.HOME }}/.cargo/bin/cargo install eza"
  args:
    creates: "{{ ansible_env.HOME }}/.cargo/bin/eza"
  become: false

- name: Add Flathub repository
  community.general.flatpak_remote:
    name: flathub
    flatpakrepo_url: https://dl.flathub.org/repo/flathub.flatpakrepo
    state: present
  become: true

- name: Install Flatpak applications
  community.general.flatpak:
    name: "{{ item }}"
    state: present
  loop:
    - com.discordapp.Discord
    - md.obsidian.Obsidian
    - com.spotify.Client
    - com.obsproject.Studio
    - org.kde.kdenlive
  become: true

- name: Include 1Password setup
  ansible.builtin.include_tasks: 1password.yml

- name: Include VS Code setup
  ansible.builtin.include_tasks: vscode.yml
